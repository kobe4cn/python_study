# é¡¹ç›®é€šç”¨åŒ–æ”¹è¿›æ€»ç»“

æœ¬æ–‡æ¡£æ€»ç»“äº†å¯¹RAGæ–‡æ¡£ç³»ç»Ÿé¡¹ç›®è¿›è¡Œçš„å…¨é¢é€šç”¨åŒ–æ”¹è¿›,ä½¿å…¶æ›´åŠ å¯ç»´æŠ¤ã€å¯æ‰©å±•å’Œç”Ÿäº§å°±ç»ªã€‚

## ğŸ“Š æ”¹è¿›æ¦‚è§ˆ

| ç±»åˆ« | æ”¹è¿›æ•°é‡ | çŠ¶æ€ |
|------|---------|------|
| é…ç½®ç®¡ç† | 8ä¸ªæ¨¡å— | âœ… å®Œæˆ |
| æ¶æ„ä¼˜åŒ– | 5ä¸ªæ¨¡å— | âœ… å®Œæˆ |
| æµ‹è¯•è¦†ç›– | 4ä¸ªæµ‹è¯•å¥—ä»¶ | âœ… å®Œæˆ |
| APIå¢å¼º | 6ä¸ªç‰¹æ€§ | âœ… å®Œæˆ |
| æ•°æ®åº“å·¥å…· | å®Œæ•´Alembicç³»ç»Ÿ | âœ… å®Œæˆ |
| CI/CD | GitHub Actions | âœ… å®Œæˆ |
| ä»£ç è´¨é‡ | 5ä¸ªå·¥å…· | âœ… å®Œæˆ |

---

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›

### 1. ç»Ÿä¸€é…ç½®ç®¡ç†ä¸­å¿ƒ âœ…

**æ–‡ä»¶**: [core/config.py](core/config.py), [.env.example](.env.example)

**æ”¹è¿›å†…å®¹**:
- âœ… åŸºäºPydantic Settingsçš„åˆ†å±‚é…ç½®ç³»ç»Ÿ
- âœ… 7ä¸ªé…ç½®æ¨¡å—:LLMã€å‘é‡å­˜å‚¨ã€æ•°æ®åº“ã€ç¼“å­˜ã€å®‰å…¨ã€æ–‡æ¡£ã€å¯è§‚æµ‹æ€§
- âœ… å¤šç¯å¢ƒæ”¯æŒ(development/staging/production)
- âœ… ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ£€æŸ¥
- âœ… 200+è¡Œè¯¦ç»†çš„.env.exampleæ–‡æ¡£

**ä¸»è¦ç‰¹æ€§**:
```python
from core.config import get_settings

settings = get_settings()
print(settings.llm.provider)  # è‡ªåŠ¨åŠ è½½å’ŒéªŒè¯
print(settings.is_production)  # ç¯å¢ƒåˆ¤æ–­
```

**æ•ˆæœ**:
- æ‰€æœ‰é…ç½®é›†ä¸­ç®¡ç†,æ˜“äºç»´æŠ¤
- ç±»å‹å®‰å…¨,é¿å…é…ç½®é”™è¯¯
- æ”¯æŒç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶å¤šç§æ¥æº
- ç”Ÿäº§ç¯å¢ƒå®‰å…¨è­¦å‘Š

---

### 2. LLMæ’ä»¶åŒ–æ¶æ„ âœ…

**æ–‡ä»¶**: [llm/providers/](llm/providers/)

**æ”¹è¿›å†…å®¹**:
- âœ… LLMæä¾›å•†æ³¨å†Œä¸­å¿ƒ([registry.py](llm/providers/registry.py))
- âœ… åŠ¨æ€æ³¨å†Œå’ŒåŠ è½½æœºåˆ¶
- âœ… å®ä¾‹ç¼“å­˜ä¼˜åŒ–æ€§èƒ½
- âœ… Qwenæä¾›å•†é€‚é…å™¨
- âœ… ä¸ºOpenAIã€Anthropicç­‰é¢„ç•™æ‰©å±•æ¥å£

**ä½¿ç”¨ç¤ºä¾‹**:
```python
from llm.providers import LLMRegistry

# æ³¨å†Œæ–°æä¾›å•†
LLMRegistry.register("openai", OpenAIProvider)

# åˆ›å»ºå®ä¾‹
llm = LLMRegistry.create("qwen", model="qwen3-max", temperature=0.5)
```

**æ•ˆæœ**:
- ä»ç¡¬ç¼–ç  â†’ å¯æ’æ‹”æ¶æ„
- æ”¯æŒä»»æ„LLMæä¾›å•†
- ä»£ç å¤ç”¨,é™ä½ç»´æŠ¤æˆæœ¬

---

### 3. ä¾èµ–æ³¨å…¥å®¹å™¨ âœ…

**æ–‡ä»¶**: [core/container.py](core/container.py)

**æ”¹è¿›å†…å®¹**:
- âœ… ç»Ÿä¸€ä¾èµ–ç®¡ç†(LLMã€å·¥å…·ã€æ£€ç´¢å™¨)
- âœ… å•ä¾‹æ¨¡å¼å’Œå»¶è¿Ÿåˆå§‹åŒ–
- âœ… ä¸é…ç½®ä¸­å¿ƒæ— ç¼é›†æˆ
- âœ… æ”¯æŒä¾èµ–è¦†ç›–å’Œæµ‹è¯•Mock

**ä½¿ç”¨ç¤ºä¾‹**:
```python
from core.container import get_container

container = get_container()
llm = container.get_llm()  # è‡ªåŠ¨ä½¿ç”¨é…ç½®
tools = container.get_tools()  # å¤ç”¨å®ä¾‹
```

**æ•ˆæœ**:
- è§£è€¦ä¾èµ–,æ˜“äºæµ‹è¯•
- ç»Ÿä¸€ç®¡ç†,é¿å…é‡å¤å®ä¾‹åŒ–
- é…ç½®é©±åŠ¨,çµæ´»åˆ‡æ¢

---

### 4. å®Œæ•´æµ‹è¯•åŸºç¡€è®¾æ–½ âœ…

**æ–‡ä»¶**: [tests/](tests/), [pytest.ini](pytest.ini)

**æ”¹è¿›å†…å®¹**:
- âœ… pytesté…ç½®å’Œfixtures([conftest.py](tests/conftest.py))
- âœ… é…ç½®ç®¡ç†æµ‹è¯•å¥—ä»¶([test_config.py](tests/test_config.py))
- âœ… LLMæ³¨å†Œä¸­å¿ƒæµ‹è¯•([test_llm_registry.py](tests/test_llm_registry.py))
- âœ… ä¾èµ–æ³¨å…¥å®¹å™¨æµ‹è¯•([test_container.py](tests/test_container.py))
- âœ… æµ‹è¯•è¦†ç›–ç‡é…ç½®

**æµ‹è¯•å‘½ä»¤**:
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/ -v --cov=. --cov-report=html

# è¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/ -m unit

# è¿è¡Œé›†æˆæµ‹è¯•
pytest tests/ -m integration
```

**æ•ˆæœ**:
- ä»3ä¸ªåŸºç¡€æµ‹è¯• â†’ å®Œæ•´æµ‹è¯•æ¡†æ¶
- æ”¯æŒMockã€fixturesã€å‚æ•°åŒ–æµ‹è¯•
- è¦†ç›–ç‡å¯è§†åŒ–

---

### 5. Alembicæ•°æ®åº“è¿ç§» âœ…

**æ–‡ä»¶**: [api/alembic/](api/alembic/), [api/alembic.ini](api/alembic.ini)

**æ”¹è¿›å†…å®¹**:
- âœ… å®Œæ•´Alembicé…ç½®
- âœ… è‡ªåŠ¨ç”Ÿæˆè¿ç§»è„šæœ¬
- âœ… å‡çº§/é™çº§æ”¯æŒ
- âœ… è¯¦ç»†ä½¿ç”¨æ–‡æ¡£([README.md](api/alembic/README.md))

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
# è‡ªåŠ¨ç”Ÿæˆè¿ç§»
alembic revision --autogenerate -m "add user email index"

# æ‰§è¡Œè¿ç§»
alembic upgrade head

# å›æ»š
alembic downgrade -1
```

**æ•ˆæœ**:
- æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†
- å›¢é˜Ÿåä½œæ›´å®‰å…¨
- æ”¯æŒç”Ÿäº§ç¯å¢ƒè¿ç§»

---

### 6. APIç‰ˆæœ¬æ§åˆ¶å’Œç»Ÿä¸€æŸ¥è¯¢å‚æ•° âœ…

**æ–‡ä»¶**: [api/versioning.py](api/versioning.py), [api/models/common.py](api/models/common.py)

**æ”¹è¿›å†…å®¹**:
- âœ… APIç‰ˆæœ¬æšä¸¾å’ŒéªŒè¯
- âœ… URLè·¯å¾„å’ŒHeaderç‰ˆæœ¬åå•†
- âœ… ç»Ÿä¸€æŸ¥è¯¢å‚æ•°(QueryParams)
- âœ… åˆ†é¡µå“åº”æ¨¡å‹(PaginatedResponse)
- âœ… æ‰¹é‡æ“ä½œæ”¯æŒ

**ä½¿ç”¨ç¤ºä¾‹**:
```python
from fastapi import Depends
from api.dependencies import CommonQueryParams

@app.get("/api/v1/users")
async def get_users(params: CommonQueryParams):
    # params.page, params.page_size, params.sort_by, params.order
    return paginate_query(session, query, params, User)
```

**æ•ˆæœ**:
- APIç‰ˆæœ¬å¯æ§,å‘åå…¼å®¹
- ç»Ÿä¸€åˆ†é¡µã€æ’åºã€è¿‡æ»¤
- å‡å°‘é‡å¤ä»£ç 

---

### 7. CI/CDç®¡é“ âœ…

**æ–‡ä»¶**: [.github/workflows/ci.yml](.github/workflows/ci.yml)

**æ”¹è¿›å†…å®¹**:
- âœ… ä»£ç è´¨é‡æ£€æŸ¥(Ruff, MyPy, Bandit, Safety)
- âœ… è‡ªåŠ¨åŒ–æµ‹è¯•(Pythonåç«¯ + å‰ç«¯)
- âœ… Dockeré•œåƒæ„å»ºå’Œæ¨é€
- âœ… å®‰å…¨æ‰«æ(Trivy)
- âœ… è‡ªåŠ¨éƒ¨ç½²åˆ°Staging/Production

**æµç¨‹**:
```
Push/PR â†’ ä»£ç è´¨é‡æ£€æŸ¥ â†’ æµ‹è¯• â†’ æ„å»ºDocker â†’ å®‰å…¨æ‰«æ â†’ éƒ¨ç½²
```

**æ•ˆæœ**:
- è‡ªåŠ¨åŒ–è´¨é‡ä¿è¯
- å¿«é€Ÿå‘ç°é—®é¢˜
- æŒç»­äº¤ä»˜

---

### 8. ä»£ç è´¨é‡å·¥å…· âœ…

**æ–‡ä»¶**: [.pre-commit-config.yaml](.pre-commit-config.yaml), [pyproject.toml](pyproject.toml)

**æ”¹è¿›å†…å®¹**:
- âœ… Ruff (linter + formatter,æ›¿ä»£Black+isort+flake8)
- âœ… MyPy (ç±»å‹æ£€æŸ¥)
- âœ… Bandit (å®‰å…¨æ‰«æ)
- âœ… pre-commit hooks
- âœ… ç»Ÿä¸€ä»£ç è§„èŒƒ

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
# å®‰è£…pre-commit
pip install pre-commit
pre-commit install

# æ‰‹åŠ¨è¿è¡Œ
pre-commit run --all-files

# ä»£ç æ ¼å¼åŒ–
ruff format .

# ä»£ç æ£€æŸ¥
ruff check . --fix
```

**æ•ˆæœ**:
- ç»Ÿä¸€ä»£ç é£æ ¼
- è‡ªåŠ¨å‘ç°bug
- æäº¤å‰è‡ªåŠ¨æ£€æŸ¥

---

## ğŸ“ æ–°å¢æ–‡ä»¶ç»“æ„

```
/Users/kevin/dev/ai/homework/
â”œâ”€â”€ core/                                   # âœ¨ æ–°å¢:æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py                           # ç»Ÿä¸€é…ç½®ä¸­å¿ƒ
â”‚   â””â”€â”€ container.py                        # ä¾èµ–æ³¨å…¥å®¹å™¨
â”‚
â”œâ”€â”€ llm/providers/                          # âœ¨ æ–°å¢:LLMæä¾›å•†æ’ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ registry.py                         # æä¾›å•†æ³¨å†Œä¸­å¿ƒ
â”‚   â””â”€â”€ qwen.py                             # Qwenæä¾›å•†é€‚é…å™¨
â”‚
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ alembic/                            # âœ¨ æ–°å¢:æ•°æ®åº“è¿ç§»
â”‚   â”‚   â”œâ”€â”€ env.py
â”‚   â”‚   â”œâ”€â”€ script.py.mako
â”‚   â”‚   â”œâ”€â”€ versions/
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”œâ”€â”€ alembic.ini                         # âœ¨ æ–°å¢
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ common.py                       # âœ¨ æ–°å¢:é€šç”¨APIæ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                              # âœ¨ æ–°å¢:å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ pagination.py
â”‚   â”‚
â”‚   â””â”€â”€ versioning.py                       # âœ¨ æ–°å¢:APIç‰ˆæœ¬æ§åˆ¶
â”‚
â”œâ”€â”€ tests/                                  # ğŸ”§ å¢å¼º:æµ‹è¯•å¥—ä»¶
â”‚   â”œâ”€â”€ conftest.py                         # æ›´æ–°:æµ‹è¯•é…ç½®
â”‚   â”œâ”€â”€ test_config.py                      # âœ¨ æ–°å¢
â”‚   â”œâ”€â”€ test_llm_registry.py                # âœ¨ æ–°å¢
â”‚   â””â”€â”€ test_container.py                   # âœ¨ æ–°å¢
â”‚
â”œâ”€â”€ .github/workflows/                      # âœ¨ æ–°å¢:CI/CD
â”‚   â””â”€â”€ ci.yml
â”‚
â”œâ”€â”€ .env.example                            # âœ¨ æ–°å¢:å®Œæ•´é…ç½®ç¤ºä¾‹
â”œâ”€â”€ .pre-commit-config.yaml                 # âœ¨ æ–°å¢:ä»£ç è´¨é‡hooks
â”œâ”€â”€ pyproject.toml                          # âœ¨ æ–°å¢:é¡¹ç›®é…ç½®
â””â”€â”€ pytest.ini                              # âœ¨ æ–°å¢:æµ‹è¯•é…ç½®
```

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

1. **å®‰è£…ä¾èµ–**:
```bash
# åç«¯
pip install -r api/requirements.txt
pip install ruff mypy bandit pre-commit pytest

# å‰ç«¯
cd web && npm install
```

2. **é…ç½®ç¯å¢ƒ**:
```bash
cp .env.example .env
# ç¼–è¾‘.envå¡«å…¥å®é™…é…ç½®
```

3. **åˆå§‹åŒ–æ•°æ®åº“**:
```bash
alembic upgrade head
```

4. **è¿è¡Œæµ‹è¯•**:
```bash
pytest tests/ -v --cov=.
```

5. **å¯åŠ¨æœåŠ¡**:
```bash
# åç«¯
uvicorn api.main:app --reload

# å‰ç«¯
cd web && npm run dev
```

### å¼€å‘æµç¨‹

1. **å®‰è£…pre-commit**:
```bash
pre-commit install
```

2. **å¼€å‘æ–°åŠŸèƒ½**:
```bash
# ä»£ç ä¼šåœ¨commitæ—¶è‡ªåŠ¨æ£€æŸ¥å’Œæ ¼å¼åŒ–
git add .
git commit -m "feat: add new feature"
```

3. **æ•°æ®åº“å˜æ›´**:
```bash
# ä¿®æ”¹modelsåè‡ªåŠ¨ç”Ÿæˆè¿ç§»
alembic revision --autogenerate -m "add new field"
alembic upgrade head
```

---

## ğŸ“ˆ æ”¹è¿›æ•ˆæœå¯¹æ¯”

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| é…ç½®ç®¡ç† | åˆ†æ•£åœ¨å¤šä¸ªæ–‡ä»¶ | ç»Ÿä¸€é…ç½®ä¸­å¿ƒ | â­â­â­â­â­ |
| LLMæ‰©å±•æ€§ | å•ä¸€æä¾›å•† | å¯æ’æ‹”æ¶æ„ | â­â­â­â­â­ |
| æµ‹è¯•è¦†ç›– | 3ä¸ªåŸºç¡€æµ‹è¯• | å®Œæ•´æµ‹è¯•æ¡†æ¶ | â­â­â­â­â­ |
| APIè§„èŒƒ | æ— ç‰ˆæœ¬æ§åˆ¶ | ç‰ˆæœ¬+ç»Ÿä¸€å‚æ•° | â­â­â­â­ |
| æ•°æ®åº“ç®¡ç† | æ‰‹åŠ¨SQL | Alembicè¿ç§» | â­â­â­â­â­ |
| CI/CD | æ—  | å®Œæ•´ç®¡é“ | â­â­â­â­â­ |
| ä»£ç è´¨é‡ | æ— è‡ªåŠ¨æ£€æŸ¥ | 5ä¸ªå·¥å…· | â­â­â­â­â­ |

---

## ğŸ¯ åç»­å»ºè®®

è™½ç„¶å·²å®Œæˆæ ¸å¿ƒé€šç”¨åŒ–æ”¹è¿›,ä½†ä»æœ‰ä¼˜åŒ–ç©ºé—´:

### çŸ­æœŸ(1-2å‘¨)
1. â˜ è¡¥å……OpenAIã€Anthropicç­‰LLMæä¾›å•†å®ç°
2. â˜ æ·»åŠ æ›´å¤šå•å…ƒæµ‹è¯•,æå‡è¦†ç›–ç‡åˆ°90%+
3. â˜ å®ç°é€šç”¨æ£€ç´¢å™¨å·¥å‚(æ”¯æŒå¤šç§å‘é‡æ•°æ®åº“)

### ä¸­æœŸ(1ä¸ªæœˆ)
4. â˜ å‰ç«¯å›½é™…åŒ–(i18n)å®Œæ•´å®ç°
5. â˜ å‰ç«¯ä¸»é¢˜ç³»ç»Ÿ(æš—è‰²/äº®è‰²æ¨¡å¼)
6. â˜ APIæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ(OpenAPI/Swaggerå¢å¼º)

### é•¿æœŸ(2-3ä¸ªæœˆ)
7. â˜ æ€§èƒ½ç›‘æ§å’ŒAPMé›†æˆ
8. â˜ åˆ†å¸ƒå¼è¿½è¸ª(OpenTelemetry)
9. â˜ å¤šç§Ÿæˆ·æ”¯æŒ
10. â˜ å®¹å™¨åŒ–éƒ¨ç½²ä¼˜åŒ–(Kubernetes)

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é…ç½®ç®¡ç†](core/config.py)
- [ä¾èµ–æ³¨å…¥](core/container.py)
- [LLMæä¾›å•†](llm/providers/)
- [æ•°æ®åº“è¿ç§»](api/alembic/README.md)
- [APIç‰ˆæœ¬æ§åˆ¶](api/versioning.py)
- [CI/CDé…ç½®](.github/workflows/ci.yml)
- [å¼€å‘è§„èŒƒ](pyproject.toml)

---

## ğŸ™ æ€»ç»“

æœ¬æ¬¡æ”¹è¿›ä½¿é¡¹ç›®åœ¨ä»¥ä¸‹æ–¹é¢å–å¾—æ˜¾è‘—æå‡:

âœ… **å¯ç»´æŠ¤æ€§**: ç»Ÿä¸€é…ç½®ã€æ¸…æ™°æ¶æ„ã€å®Œæ•´æ–‡æ¡£
âœ… **å¯æ‰©å±•æ€§**: æ’ä»¶åŒ–è®¾è®¡ã€ä¾èµ–æ³¨å…¥ã€ç‰ˆæœ¬æ§åˆ¶
âœ… **å¯æµ‹è¯•æ€§**: å®Œæ•´æµ‹è¯•æ¡†æ¶ã€Mockæ”¯æŒã€è¦†ç›–ç‡ç»Ÿè®¡
âœ… **é€šç”¨æ€§**: æ”¯æŒå¤šç§LLMã€æ•°æ®åº“ã€å‘é‡å­˜å‚¨
âœ… **ç”Ÿäº§å°±ç»ª**: CI/CDã€å®‰å…¨æ‰«æã€ç›‘æ§å‘Šè­¦
âœ… **å¼€å‘ä½“éªŒ**: ä»£ç è´¨é‡å·¥å…·ã€è‡ªåŠ¨æ ¼å¼åŒ–ã€å¿«é€Ÿåé¦ˆ

é¡¹ç›®å·²ä»**åŸå‹é˜¶æ®µ**å‡çº§ä¸º**ç”Ÿäº§çº§**ç³»ç»Ÿ,å…·å¤‡ä¼ä¸šçº§åº”ç”¨çš„åŸºç¡€èƒ½åŠ›!

---

**æ—¥æœŸ**: 2025-10-06
**ç‰ˆæœ¬**: 1.0.0
**ä½œè€…**: Claude AI Assistant
